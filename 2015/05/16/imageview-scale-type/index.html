<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ImageView的scaleType设置不当，导致使用Glide时出现OOM | 某黎的博客</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="之前看到一篇介绍图片加载库——Glide的文章。

http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0327/2650.html

看到连Google官方也在用。自动缓存，自动图片压缩，支持加载网络图片、加载Gif等等，支持集成Volley和okHttp，总之好处多多。
于是找到 Glide 在Github上面的项目主页，按照说">
<meta property="og:type" content="article">
<meta property="og:title" content="ImageView的scaleType设置不当，导致使用Glide时出现OOM">
<meta property="og:url" content="http://www.licheedev.com/2015/05/16/imageview-scale-type/index.html">
<meta property="og:site_name" content="某黎的博客">
<meta property="og:description" content="之前看到一篇介绍图片加载库——Glide的文章。

http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0327/2650.html

看到连Google官方也在用。自动缓存，自动图片压缩，支持加载网络图片、加载Gif等等，支持集成Volley和okHttp，总之好处多多。
于是找到 Glide 在Github上面的项目主页，按照说">
<meta property="og:image" content="http://i1.tietuku.com/30b2314c914de3cc.png">
<meta property="og:image" content="http://i1.tietuku.com/95e9dde35552495e.jpg">
<meta property="og:updated_time" content="2015-06-12T15:55:15.418Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ImageView的scaleType设置不当，导致使用Glide时出现OOM">
<meta name="twitter:description" content="之前看到一篇介绍图片加载库——Glide的文章。

http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0327/2650.html

看到连Google官方也在用。自动缓存，自动图片压缩，支持加载网络图片、加载Gif等等，支持集成Volley和okHttp，总之好处多多。
于是找到 Glide 在Github上面的项目主页，按照说">
  
  
    <link rel="icon" href="/favicon.png">
  

  <link rel="stylesheet" href="/css/style.css" type="text/css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  
  
    <link rel="stylesheet" href="/scrollLoading/style.css" type="text/css">
  
  


  

  
    <link href='//fonts.useso.com/css?family=Titillium+Web:300,400,600' rel='stylesheet' type='text/css'>
    <link href="//fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  

</head>

<body>
  <div id="wrap">
    <header id="header">
  <div id="header-outer" class="outer">
    <div class="container">
      <div class="container-inner">
        <div id="header-title">
          <h1 class="logo-wrap">
            <a href="/" class="logo"></a>
          </h1>
          
            <h2 class="subtitle-wrap">
              <p class="subtitle">某黎的博客</p>
            </h2>
          
        </div>
        <div id="header-inner" class="nav-container">
          <a id="main-nav-toggle" class="nav-icon"></a>
          <div class="nav-container-inner">
            <ul id="main-nav">
              
                <li class="main-nav-list-item" ><a class="main-nav-list-link" href="/">Home</a></li>
              
                    <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Android/">Android</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/python/">python</a></li></ul>
                  
                <li class="main-nav-list-item" ><a class="main-nav-list-link" href="/about/index.html">About</a></li>
              
            </ul>
            <nav id="sub-nav">
              <div id="search-form-wrap">
                <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="搜索"><input type="hidden" name="sitesearch" value="http://www.licheedev.com"></form>
              </div>
            </nav>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>
    <div class="container">
      <div class="main-body container-inner">
        <div class="main-body-inner">
          <section id="main">
            <div class="main-body-header">

              <h1 class="header"><a class="page-title-link" href="/categories/Android/">Android</a></h1>
            </div>
            <div class="main-body-content">
              
  <article id="post-imageview-scale-type" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
      <!--  -->
      
        <header class="article-header">
          
  
    <h1 class="article-title" itemprop="name">
      ImageView的scaleType设置不当，导致使用Glide时出现OOM
    </h1>
  

        </header>
      
      <p class="article-byline">
        <a href="/2015/05/16/imageview-scale-type/" class="article-date">
  <time datetime="2015-05-16T13:07:01.000Z" itemprop="datePublished">2015-05-16</time>
</a>
      </p>
      <div class="article-entry" itemprop="articleBody">
        <p>之前看到一篇介绍图片加载库——Glide的文章。</p>
<blockquote>
<p><a href="http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0327/2650.html" target="_blank" rel="external">http://www.jcodecraeer.com/a/anzhuokaifa/androidkaifa/2015/0327/2650.html</a></p>
</blockquote>
<p>看到连Google官方也在用。自动缓存，自动图片压缩，支持加载网络图片、加载Gif等等，支持集成Volley和okHttp，总之好处多多。</p>
<p>于是找到 <a href="https://github.com/bumptech/glide" target="_blank" rel="external"><strong>Glide</strong></a> 在Github上面的项目主页，按照说明写了个简单的Demo。<br><a id="more"></a></p>
<p><img src="http://i1.tietuku.com/30b2314c914de3cc.png" alt="glide"></p>
<p>简单描述一下Demo吧，就是在tomcat上面弄一个webapp，里面就放了70来张非常大的jpg图片（某个<a href="http://sukebei.nyaa.se/?page=view&amp;tid=1023869" target="_blank" rel="external">エロゲーム</a> 的CG，因为内容比较和谐，我就不细说了，总之每张图都有<code>2560*1400</code>分辨率，<a href="http://i1.tietuku.com/4bfa5ae0477c644d.jpg" target="_blank" rel="external">sample</a>，刚好用来测试性能），还有包含着这些图片地址的json文件。</p>
<p>然后就是写个ListView，加载这些图片了。什么convertView复用，ViewHolder也弄好了。</p>
<p>运行，图片顺利加载，慢慢拖动，貌似也没问题，但是一快速滑动（也就是fling），就变得非常卡，Logcat出现 OutOfMemoryError。</p>
<p><img src="http://i1.tietuku.com/95e9dde35552495e.jpg" alt="OOM"></p>
<p>检查了下程序逻辑，没啥问题，Glide的介绍提到了会按照ImageView大小了缩放和缓存图像，不至于这样啊。</p>
<p>百思不得其解，就去Glide项目页那里，用蹩脚的英文发了个issue，然后<a href="https://github.com/TWiStErRob" target="_blank" rel="external">@TWiStErRob</a>大神也很用心地回答了。</p>
<blockquote>
<p><a href="https://github.com/bumptech/glide/issues/464" target="_blank" rel="external">https://github.com/bumptech/glide/issues/464</a><br><br>Glad it helped. Feel free to ask further questions if you’re stuck.<br><br>For posterity: fitXY forces Glide to read at full resolution and then let the ImageView handle the distortion (fitXY doesn’t keep aspect ratio). If you want to keep distorting the images, you can keep fitXY on the imageView and call centerCrop() or fitCenter() before load(): this will make Glide downsample the image (less memory) before handing it to ImageView for distortion.<br><br>Here’s a further tip I just noticed: you could also change android:src to tools:src. That way you will save some layout passes (ImageView does a layout on every setImage*() call) and you can skip loading a bitmap (launcher icon when inflating each item) unnecessarily (you’ll overwrite it anyway with Glide). The tools attributes are not compiled into the apk, so it’s optimal to use them in these situations.</p>
</blockquote>
<p>原来是ImageView的<code>scaleType</code>的问题，当设置为<code>fitXY</code>时，虽然ImageView显示那么点尺寸，但是，但是Glide加载图片时，却是以全分辨率加载的，于是加载几张，就OOM了。<br>改成<code>fitCenter</code>或者<code>centerCrop</code>(试了一下<code>fitStart</code>、<code>fitEnd</code>也行，总之看需求了)，就好了，会自动缓存小图，滚动起来也非常流畅。</p>
<p>完全没想到原来坑在<code>scaleType</code>上面，这下记住了。</p>
<p>最后感谢<a href="https://github.com/TWiStErRob" target="_blank" rel="external">@TWiStErRob</a>大神的耐心回答，Github已follow。</p>

      </div>
      <footer class="article-footer">
        <a data-url="http://www.licheedev.com/2015/05/16/imageview-scale-type/" data-id="ciatuxig4000idwhmg7e7lq95" class="article-share-link">分享到</a>
        
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Glide/">Glide</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ImageView/">ImageView</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/scaleType/">scaleType</a></li></ul>

      </footer>
    </div>
  </article>
  

            </div>
          </section>
          <aside id="sidebar">
  <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
  <div class="sidebar-top">
    <p>关注我 :</p>
    <ul class="social-links">
      
        <li><a class="social-tooltip" title="twitter" href="/" target="_blank"><i id="icon-twitter" class="icon"></i></a></li>
      
        <li><a class="social-tooltip" title="facebook" href="/" target="_blank"><i id="icon-facebook" class="icon"></i></a></li>
      
        <li><a class="social-tooltip" title="google_plus" href="/" target="_blank"><i id="icon-google_plus" class="icon"></i></a></li>
      
        <li><a class="social-tooltip" title="github" href="https://github.com/licheedev" target="_blank"><i id="icon-github" class="icon"></i></a></li>
      
        <li><a class="social-tooltip" title="weibo" href="http://weibo.com/licheedev" target="_blank"><i id="icon-weibo" class="icon"></i></a></li>
      
        <li><a class="social-tooltip" title="rss" href="/" target="_blank"><i id="icon-rss" class="icon"></i></a></li>
      
    </ul>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/05/20/manifest-merger-failed/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">下一篇</strong>
      <p class="article-nav-title">
        
          解决Android Studio添加依赖时出现“Manifest merger failed”
        
      </p>
      <i class="icon" id="icon-chevron-right"></i>
    </a>
  
  
    <a href="/2015/05/05/hide-taskbar/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">上一篇</strong>
      <p class="article-nav-title">坑爹显示器分辨率太低，任务栏遮住Android Studio的按钮了</p>
      <i class="icon" id="icon-chevron-left"></i>
    </a>
  
</nav>

  
  <div class="widgets-container">
    
      
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul id="recent-post" class="">
        
          <li>
            
            <div class="item-thumbnail">
              
<a href="/2015/05/23/android-multi-dex/" class="thumbnail">
  
    <span style="background-image:url(http://i1.tietuku.com/1ff2c42573e52e93.jpg
)" alt="使用Multidex解决App方法数超过65536限制问题" class="thumbnail-image"></span>
  
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/Android/">Android</a></p>
              <p class="item-title"><a href="/2015/05/23/android-multi-dex/" class="title">使用Multidex解决App方法数超过65536限制问题</a></p>
              <p class="item-date"><time datetime="2015-05-23T15:54:35.000Z" itemprop="datePublished">2015-05-23</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              
<a href="/2015/05/21/android-best-practices/" class="thumbnail">
  
    <span class="thumbnail-image thumbnail-none"></span>
  
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/Android/">Android</a></p>
              <p class="item-title"><a href="/2015/05/21/android-best-practices/" class="title">【转载】Android 开发最佳实践</a></p>
              <p class="item-date"><time datetime="2015-05-20T16:27:36.000Z" itemprop="datePublished">2015-05-21</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              
<a href="/2015/05/20/manifest-merger-failed/" class="thumbnail">
  
    <span style="background-image:url(http://i1.tietuku.com/0373d83ce0e7c039.png
)" alt="解决Android Studio添加依赖时出现“Manifest merger failed”" class="thumbnail-image"></span>
  
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/Android/">Android</a></p>
              <p class="item-title"><a href="/2015/05/20/manifest-merger-failed/" class="title">解决Android Studio添加依赖时出现“Manifest merger failed”</a></p>
              <p class="item-date"><time datetime="2015-05-20T14:29:31.000Z" itemprop="datePublished">2015-05-20</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              
<a href="/2015/05/16/imageview-scale-type/" class="thumbnail">
  
    <span style="background-image:url(http://i1.tietuku.com/30b2314c914de3cc.png
)" alt="ImageView的scaleType设置不当，导致使用Glide时出现OOM" class="thumbnail-image"></span>
  
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/Android/">Android</a></p>
              <p class="item-title"><a href="/2015/05/16/imageview-scale-type/" class="title">ImageView的scaleType设置不当，导致使用Glide时出现OOM</a></p>
              <p class="item-date"><time datetime="2015-05-16T13:07:01.000Z" itemprop="datePublished">2015-05-16</time></p>
            </div>
          </li>
        
          <li>
            
            <div class="item-thumbnail">
              
<a href="/2015/05/05/hide-taskbar/" class="thumbnail">
  
    <span style="background-image:url(http://i2.tietuku.com/33d13545e136d9ab.jpg
)" alt="坑爹显示器分辨率太低，任务栏遮住Android Studio的按钮了" class="thumbnail-image"></span>
  
</a>

            </div>
            
            <div class="item-inner">
              <p class="item-category"><a class="article-category-link" href="/categories/Android/">Android</a></p>
              <p class="item-title"><a href="/2015/05/05/hide-taskbar/" class="title">坑爹显示器分辨率太低，任务栏遮住Android Studio的按钮了</a></p>
              <p class="item-date"><time datetime="2015-05-05T15:22:43.000Z" itemprop="datePublished">2015-05-05</time></p>
            </div>
          </li>
        
      </ul>
    </div>
  </div>

    
      
  <div class="widget-wrap widget-list">
    <h3 class="widget-title">分类</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/python/">python</a><span class="category-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap widget-list">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">三月 2015</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap widget-list">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android-Studio/">Android Studio</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Glide/">Glide</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gradle/">Gradle</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ImageView/">ImageView</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ListView/">ListView</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ViewHolder/">ViewHolder</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/python/">python</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scaleType/">scaleType</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/volley/">volley</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>


    
      
  <div class="widget-wrap widget-float">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/Android/" style="font-size: 10px;">Android</a> <a href="/tags/Android-Studio/" style="font-size: 20px;">Android Studio</a> <a href="/tags/Glide/" style="font-size: 10px;">Glide</a> <a href="/tags/Gradle/" style="font-size: 20px;">Gradle</a> <a href="/tags/ImageView/" style="font-size: 10px;">ImageView</a> <a href="/tags/ListView/" style="font-size: 20px;">ListView</a> <a href="/tags/ViewHolder/" style="font-size: 20px;">ViewHolder</a> <a href="/tags/python/" style="font-size: 10px;">python</a> <a href="/tags/scaleType/" style="font-size: 10px;">scaleType</a> <a href="/tags/volley/" style="font-size: 10px;">volley</a>
    </div>
  </div>


    
      
  <div class="widget-wrap widget-list">
    <h3 class="widget-title">链接</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="http://hexo.io">Hexo</a>
          </li>
        
      </ul>
    </div>
  </div>


    
  </div>
</aside>
        </div>
      </div>
    </div>
    <footer id="footer">
  
  <div class="container">
    <div class="container-inner">
      <a id="back-to-top" href="javascript:;"><i class="icon" id="icon-angle-up"></i></a>
      <div class="credit">
        <h1 class="logo-wrap">
          <a href="/" class="logo"></a>
        </h1>
        <p>&copy; 2015 John Lee</p>
        <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
      </div>
    </div>
  </div>
</footer>
    


  <script src="http://code.jquery.com/jquery-2.1.3.min.js"></script>



  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



  <script src="/scrollLoading/jquery.scrollLoading.js" type="text/javascript"></script>
  <script src="/scrollLoading/main.js" type="text/javascript"></script>


<script src="/js/html-patch.js" type="text/javascript"></script>
<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>
